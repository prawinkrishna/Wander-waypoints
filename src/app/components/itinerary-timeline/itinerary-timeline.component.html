<div class="itinerary-container">
    <div *ngFor="let group of groupedPlaces" class="day-group">
        <!-- Day Header with Collapse -->
        <div class="day-header" (click)="toggleDay(group.dayNumber)">
            <h3>Day {{ group.dayNumber }}</h3>
            <mat-icon class="chevron-icon" [class.collapsed]="isDayCollapsed(group.dayNumber)">
                expand_more
            </mat-icon>
        </div>

        <!-- Day Content (Collapsible) -->
        <div class="day-content" *ngIf="!isDayCollapsed(group.dayNumber)">
            <div cdkDropList (cdkDropListDropped)="onReorderPlace($any($event), group)" class="places-list">
                <div *ngFor="let item of group.places; let last = last" 
                     cdkDrag 
                     class="place-item">
                    
                    <!-- Place Card -->
                    <div class="place-card">
                        <!-- Drag Handle -->
                        <div class="drag-handle" cdkDragHandle>
                            <mat-icon>drag_indicator</mat-icon>
                        </div>

                        <!-- Place Image with Rating Badge -->
                        <div class="place-image-container clickable" (click)="viewPlaceDetails(item)">
                            <img [src]="item.place?.image || 'https://via.placeholder.com/200x150?text=No+Image'" 
                                 [alt]="item.place?.name"
                                 class="place-image">
                            <div class="rating-badge" *ngIf="item.place?.rating">
                                <span>{{ item.place.rating }}</span>
                                <mat-icon>star</mat-icon>
                            </div>
                        </div>

                        <!-- Place Content -->
                        <div class="place-content clickable" (click)="viewPlaceDetails(item)">
                            <!-- Place Type Icon -->
                            <div class="place-type-icon" 
                                 [style.background-color]="getPlaceTypeColor(item.place?.category)">
                                <mat-icon>{{ getCategoryIcon(item.place?.category) }}</mat-icon>
                            </div>

                            <!-- Place Name -->
                            <h4 class="place-name">{{ item.place?.name }}</h4>

                            <!-- Place Address -->
                            <div class="place-address" *ngIf="item.place?.address">
                                <mat-icon>location_on</mat-icon>
                                <span>{{ item.place.address }}</span>
                            </div>

                            <!-- Place Description -->
                            <p class="place-description" *ngIf="item.place?.description">
                                {{ item.place.description }}
                            </p>

                            <!-- Notes -->
                            <p class="place-notes" *ngIf="item.notes">
                                <mat-icon>note</mat-icon>
                                <span>{{ item.notes }}</span>
                            </p>
                        </div>

                        <!-- Book Button (for hotels) -->
                        <button mat-raised-button 
                                class="book-button" 
                                *ngIf="isBookable(item)"
                                (click)="onBookPlace(item)">
                            Book
                        </button>

                        <!-- Delete Button -->
                        <button mat-icon-button 
                                class="delete-button" 
                                (click)="onDeletePlace(item.tripPlaceId)">
                            <mat-icon>close</mat-icon>
                        </button>
                    </div>

                    <!-- Travel Info to Next Place -->
                    <div class="travel-info" *ngIf="!last">
                        <div class="travel-stats">
                            <mat-icon>directions_car</mat-icon>
                            <span>{{ item.travelTimeFromPrev || '0h 9m' }}</span>
                            <span class="dot-separator">â€¢</span>
                            <span>{{ item.distanceFromPrev || '3.3' }} mi</span>
                        </div>
                        <a class="direction-link" (click)="openDirections(item)">
                            <mat-icon>navigation</mat-icon>
                            Direction
                        </a>
                    </div>

                    <!-- CDK Drag Placeholder -->
                    <div class="place-card-placeholder" *cdkDragPlaceholder></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="groupedPlaces.length === 0">
        <mat-icon>event_note</mat-icon>
        <h3>No Itinerary Yet</h3>
        <p>Add places to your trip to create an itinerary</p>
    </div>
</div>